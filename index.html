<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>YourSpace Tree-sure Hunt</title>
</head>

<style>
  #tree_map {
    height: 100%;
    width: 100%;
    left: 0;
    position: absolute;
    top: 100px;
    background-color: palegreen;
  }
</style>

<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcPEL3GsHaFKvBHv1gX2ergBKIA1HIq3o&callback=initMap&libraries=geometry">
</script>

<body>
    <p>YourSpace Tree-sure Hunt</p>
    <div id="tree_map"></div>
  
    <script>
      // variable declared to store the map object
      var tree_map;
  
      // tolerance value in metres
      var tolerance = 25;
  
      // all_markers array initialised to store the marker objects
      var all_markers = [];
  
      // data variable contains the marker data in a string format
      var data = `51.36090873171403 -0.2128131693115165 tree.png
      51.36158534804417 -0.21196022684478066 flower.png
      51.3647254538826 -0.21169339639094842 leaf.png`;
  
      // Split data by new line
      var markers = data.split("\n");
  
      // Variable to store the user's marker
      var userMarker;
  
      // initMap() function is defined, which will be called to initialise the map and create markers.
      function initMap() {
        // tree_map created using the google.maps.Map constructor, specifying the map element and its options
        tree_map = new google.maps.Map(document.getElementById('tree_map'), {
          zoom: 18,
          center: {
            lat: 51.361376,
            lng: -0.212899
          }
        });
  
        // Check for geolocation support and watch the user's position
        if (navigator.geolocation) {
          navigator.geolocation.watchPosition(set_my_position);
        } else {
          alert("Geolocation doesn't work in your browser");
        }
  
        // Loops through the array of markers
        for (var i = 0; i < markers.length; i++) {
          var markerData = markers[i].trim().split(" ");
  
          var latitude = parseFloat(markerData[0]);
          var longitude = parseFloat(markerData[1]);
          var icon = markerData[2];
  
          var markerPosition = {
            lat: latitude,
            lng: longitude
          };
  
          var marker = new google.maps.Marker({
            position: markerPosition,
            map: tree_map,
            icon: icon
          });
  
          all_markers.push(marker);
        }
      }
  
      // Geolocation callback function
      function set_my_position(position) {
        var pos = {
          lat: position.coords.latitude,
          lng: position.coords.longitude
        };
  
        removeUserMarker();
        createUserMarker(pos);
      }
  
      function removeUserMarker() {
        if (userMarker) {
          userMarker.setMap(null);
        }
      }
  
      function createUserMarker(position) {
        userMarker = new google.maps.Marker({
          position: position,
          map: tree_map,
          icon: 'https://maps.google.com/mapfiles/kml/shapes/man.png'
        });

        function handleMarkerDetection(position) {
      for (var i = 0; i < all_markers.length; i++) {
        var marker = all_markers[i];

        if (marker === userMarker) {
          continue;
        }

        var distance = google.maps.geometry.spherical.computeDistanceBetween(position, marker.getPosition());

        if (distance < tolerance) {
          var what_is_it = marker.getIcon();
          what_is_it = what_is_it.replace(".png", "");
          alert("Found the " + what_is_it);
          marker.setMap(null);
          all_markers.splice(i, 1);
          i--;
        }
      }
    }
  }
  </script>

</body>

</html>
